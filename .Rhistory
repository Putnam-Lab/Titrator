sample_names
# create a list with all the sample IDs
sample_names_list <- list()
for (item in 1:length(sample_names)){
sample_names_list[[item]] <- sample_names[item]
}
View(sample_names_list)
# fill the list with the data from each sample
for (i in 1:nrows){
sample_names_list[[i]]<-data.frame(AllData[sample_name_positions[i]:sample_name_positions[i+1],])
colnames(sample_names_list[[i]])<-c("Volume","Time","mV","Temperature","dV/dt")
}
View(sample_names_list)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(sample_names_list)
Data<-sample_names_list[[1]]
Data$mV<-suppressWarnings(as.numeric(Data$mV)) ## supress the warnings since NA will be produced
Data$Temperature<-suppressWarnings(as.numeric(Data$Temperature))
Data$Volume<-suppressWarnings(as.numeric(Data$Volume))
name<-sample_names[1]
mV<-which(Data$mV<pH3 & Data$mV>pH35)
d<-(-0.00000400*mean(Data$Temperature[mV], na.rm=T)^2-0.0001116*mean(Data$Temperature[mV], na.rm=T)+1.02881) #20220127 Batch A22 DMBP
c<-0.100347 ##Batch A22 first used by DMBP on 20220127
#Salinity of your samples, set salinity for all titrations using a junk or CRM (single value)
s<-Mass[Mass$Sample.ID1==name,3]
#mass of sample in g: changed with every sample
#mass<-Mass[name,1]
mass<-Mass[Mass$Sample.ID1==name,2]
#at function is based on code in saecarb package by Steeve Comeau, Heloise Lavigne and Jean-Pierre Gattuso
TA[i,1]<-name #exports the sample ID into output file, column 1
TA[i,2]<-1000000*at(S=s,T=mean(Data$Temperature[mV], na.rm=T), C=c, d=d, pHTris=NULL, ETris=NULL, weight=mass, E=Data$mV[mV], volume=Data$Volume[mV])
View(TA)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(TA)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
sample_name_positions
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(TA)
View(sample_names_list)
View(AllData)
View(cumu.data)
View(Data)
View(Mass)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
setwd("C:/Users/PPP Lab/Documents/Titrator")
main<-getwd()
#load libraries----------------------------------------------
library(seacarb) #used to calculate TA
library(tidyverse)
#CHANGE THESE VALUES EVERY DAY----------------------------------------------
path<-"Data/BlueTank_Titrations/20220518" #the location of all your titration files, your folder of the day!
massfile<-"Mass_20220518.csv" # name of your file with masses
titrationfile<-'20220504_PutnamLab.csv'# name of the last titration file run
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(Mass)
View(Data)
View(sample_names_list)
View(TA)
Data<-sample_names_list[[i]]
Data$mV<-suppressWarnings(as.numeric(Data$mV)) ## supress the warnings since NA will be produced
Data$Temperature<-suppressWarnings(as.numeric(Data$Temperature))
Data$Volume<-suppressWarnings(as.numeric(Data$Volume))
View(Data)
name<-sample_names[i]
mV<-which(Data$mV<pH3 & Data$mV>pH35)
d<-(-0.00000400*mean(Data$Temperature[mV], na.rm=T)^2-0.0001116*mean(Data$Temperature[mV], na.rm=T)+1.02881) #20220127 Batch A22 DMBP
c<-0.100347 ##Batch A22 first used by DMBP on 20220127
d
View(Data)
#Salinity of your samples, set salinity for all titrations using a junk or CRM (single value)
s<-Mass[Mass$Sample.ID1==name,3]
#mass of sample in g: changed with every sample
#mass<-Mass[name,1]
mass<-Mass[Mass$Sample.ID1==name,2]
#at function is based on code in saecarb package by Steeve Comeau, Heloise Lavigne and Jean-Pierre Gattuso
TA[i,1]<-name #exports the sample ID into output file, column 1
View(TA)
TA[i,2]<-1000000*at(S=s,T=mean(Data$Temperature[mV], na.rm=T), C=c, d=d, pHTris=NULL, ETris=NULL, weight=mass, E=Data$mV[mV], volume=Data$Volume[mV])
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(TA)
View(Data)
View(AllData)
View(Mass)
#Calculate total alkalinity using potentiometric titrations
#Uses a for loop to read in data exported as a titration file and calculate Total alkalinity
#At the end it exports your data as a .csv file. Comment the last line out if your don't want that.
### Files needed ######
# 1. pHCalibration.csv in your "Data" folder
#Inside the Data folder You must have a subfolder for each data set. In each subfolder there is:
#2. the mass file for your run
#3. a subfolder named "TodaysDate" (where all of your titration files are) directly exported from LabX.
# Created by Nyssa Silbiger 03/28/2014
# modified 20210126 Sam Gurr - set diff directories and such for PPP Lab titrator (URI)
# new acid bottle 20190626 by Sam Gurr - changed lines
#line 68 changed SampleID to Sample.ID - Sam Gurr 20180713
#modified 20210221 Danielle Becker - set different mass file and Titratorfile to match code
#modified 20210318 Danielle Becker - opened a new acid titrant, same batch #A16
#new acid bottle 20220127 by Danielle Becker - new batch number A22, updated script calculation
#------------------------------------------------------------
rm(list=ls())
#set working directory---------------------------------------------------------------------------------------------
setwd("C:/Users/PPP Lab/Documents/Titrator")
main<-getwd()
#load libraries----------------------------------------------
library(seacarb) #used to calculate TA
library(tidyverse)
#CHANGE THESE VALUES EVERY DAY----------------------------------------------
path<-"Data/BlueTank_Titrations/20220518" #the location of all your titration files, your folder of the day!
massfile<-"Mass_20220518.csv" # name of your file with masses
titrationfile<-'20220518_PutnamLab.csv'# name of the last titration file run
# Date that the data were run
date<-'20220518'
#DO NOT CHANGE ANYTHING BELOW THIS LINE UNLESS A NEW BOTTLE OF ACID IS USED
#load Data---------------------------------------------------
#load Mass Data
Mass<-read.csv(file.path(path,massfile), header=T, sep=",", na.string="NA", as.is=T)
#### pH Calibration #####
pHCal<-read.csv("Data/pHCalibration.csv") # read in the pH Calibration file
#select the calibration for the correct date
pHData<-pHCal[pHCal$Date==date,]
# calculate pH 3 and 3.5 based on the slope and intercept from pH 4, 7, and 10 calibration
mod.pH<-lm(c(pHData$pH4, pHData$pH7, pHData$pH10)~c(4,7,10)) # linear model
# print a plot of the relationship between pH and mV
png(paste0(path,"/",Sys.Date(),'pHmvplot.png'), height = 400, width = 400)
plot(c(4,7,10), c(pHData$pH4, pHData$pH7, pHData$pH10), xlab = 'pH', ylab = 'mv')
lines(c(4,7,10), predict(mod.pH))
R2<-summary(mod.pH)$r.squared
legend('topright', legend = bquote(R^2 == .(format(R2, digits = 3))), bty='n')
dev.off()
# Select the mV for pH=3 and pH=3.5 based on your probe calibration
pH35<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3.5
pH3<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3
##### titration###########
#create an empty matrix to put the TA values in
nrows<-nrow(Mass) #need file length/number of rows
TA <- data.frame(matrix(nrow = nrows, ncol = 4))
rownames(TA)<-Mass$Sample.ID1[1:nrows]
colnames(TA)<-c("SampleID",'TA','Mass','Salinity') # changed Sample.ID1 to SampleID in the TA data frame only
#run a for loop to bring in the titration files one at a time and calculate TA
# read in the mega concatenated titration results file
filename<-file.path(path,titrationfile)
AllData<-read.csv(filename, sep=",", na.string="NA", as.is=T, skip=4)[ ,1:5]
#Identifies rows starting with scope in column 1 of the titration file
sample_name_positions <- c(1,grep("^Scope", AllData[,1]), nrow(AllData))
## parse through all the data in the one file ###
sample_names<-Mass$Sample.ID1
# create a list with all the sample IDs
sample_names_list <- list()
for (item in 1:length(sample_names)){
sample_names_list[[item]] <- sample_names[item]
}
# fill the list with the data from each sample
for (i in 1:nrows){
sample_names_list[[i]]<-data.frame(AllData[sample_name_positions[i]:sample_name_positions[i+1],])
colnames(sample_names_list[[i]])<-c("Volume","Time","mV","Temperature","dV/dt")
}
View(pHData)
View(sample_names_list)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(sample_names_list)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(sample_names_list)
View(sample_names_list)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(sample_names_list)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
#Calculate total alkalinity using potentiometric titrations
#Uses a for loop to read in data exported as a titration file and calculate Total alkalinity
#At the end it exports your data as a .csv file. Comment the last line out if your don't want that.
### Files needed ######
# 1. pHCalibration.csv in your "Data" folder
#Inside the Data folder You must have a subfolder for each data set. In each subfolder there is:
#2. the mass file for your run
#3. a subfolder named "TodaysDate" (where all of your titration files are) directly exported from LabX.
# Created by Nyssa Silbiger 03/28/2014
# modified 20210126 Sam Gurr - set diff directories and such for PPP Lab titrator (URI)
# new acid bottle 20190626 by Sam Gurr - changed lines
#line 68 changed SampleID to Sample.ID - Sam Gurr 20180713
#modified 20210221 Danielle Becker - set different mass file and Titratorfile to match code
#modified 20210318 Danielle Becker - opened a new acid titrant, same batch #A16
#new acid bottle 20220127 by Danielle Becker - new batch number A22, updated script calculation
#------------------------------------------------------------
rm(list=ls())
#set working directory---------------------------------------------------------------------------------------------
setwd("C:/Users/PPP Lab/Documents/Titrator")
main<-getwd()
#load libraries----------------------------------------------
library(seacarb) #used to calculate TA
library(tidyverse)
#CHANGE THESE VALUES EVERY DAY----------------------------------------------
path<-"Data/BlueTank_Titrations/20220518" #the location of all your titration files, your folder of the day!
massfile<-"Mass_20220518.csv" # name of your file with masses
titrationfile<-'20220518_PutnamLab.csv'# name of the last titration file run
# Date that the data were run
date<-'20220518'
#DO NOT CHANGE ANYTHING BELOW THIS LINE UNLESS A NEW BOTTLE OF ACID IS USED
#load Data---------------------------------------------------
#load Mass Data
Mass<-read.csv(file.path(path,massfile), header=T, sep=",", na.string="NA", as.is=T)
#### pH Calibration #####
pHCal<-read.csv("Data/pHCalibration.csv") # read in the pH Calibration file
#select the calibration for the correct date
pHData<-pHCal[pHCal$Date==date,]
# calculate pH 3 and 3.5 based on the slope and intercept from pH 4, 7, and 10 calibration
mod.pH<-lm(c(pHData$pH4, pHData$pH7, pHData$pH10)~c(4,7,10)) # linear model
# print a plot of the relationship between pH and mV
png(paste0(path,"/",Sys.Date(),'pHmvplot.png'), height = 400, width = 400)
plot(c(4,7,10), c(pHData$pH4, pHData$pH7, pHData$pH10), xlab = 'pH', ylab = 'mv')
lines(c(4,7,10), predict(mod.pH))
R2<-summary(mod.pH)$r.squared
legend('topright', legend = bquote(R^2 == .(format(R2, digits = 3))), bty='n')
dev.off()
# Select the mV for pH=3 and pH=3.5 based on your probe calibration
pH35<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3.5
pH3<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3
##### titration###########
#create an empty matrix to put the TA values in
nrows<-nrow(Mass) #need file length/number of rows
TA <- data.frame(matrix(nrow = nrows, ncol = 4))
rownames(TA)<-Mass$Sample.ID1[1:nrows]
colnames(TA)<-c("SampleID",'TA','Mass','Salinity') # changed Sample.ID1 to SampleID in the TA data frame only
#run a for loop to bring in the titration files one at a time and calculate TA
# read in the mega concatenated titration results file
filename<-file.path(path,titrationfile)
AllData<-read.csv(filename, sep=",", na.string="NA", as.is=T, skip=4)[ ,1:5]
#Identifies rows starting with scope in column 1 of the titration file
sample_name_positions <- c(1,grep("^Scope", AllData[,1]), nrow(AllData))
## parse through all the data in the one file ###
sample_names<-Mass$Sample.ID1
# create a list with all the sample IDs
sample_names_list <- list()
for (item in 1:length(sample_names)){
sample_names_list[[item]] <- sample_names[item]
}
# fill the list with the data from each sample
for (i in 1:nrows){
sample_names_list[[i]]<-data.frame(AllData[sample_name_positions[i]:sample_name_positions[i+1],])
colnames(sample_names_list[[i]])<-c("Volume","Time","mV","Temperature","dV/dt")
}
View(TA)
Data<-sample_names_list[[i]]
View(Data)
Data$mV<-suppressWarnings(as.numeric(Data$mV)) ## supress the warnings since NA will be produced
Data$Temperature<-suppressWarnings(as.numeric(Data$Temperature))
Data$Volume<-suppressWarnings(as.numeric(Data$Volume))
View(Data)
name<-sample_names[i]
mV<-which(Data$mV<pH3 & Data$mV>pH35)
d<-(-0.00000400*mean(Data$Temperature[mV], na.rm=T)^2-0.0001116*mean(Data$Temperature[mV], na.rm=T)+1.02881) #20220127 Batch A22 DMBP
c<-0.100347 ##Batch A22 first used by DMBP on 20220127
#Calculate total alkalinity using potentiometric titrations
#Uses a for loop to read in data exported as a titration file and calculate Total alkalinity
#At the end it exports your data as a .csv file. Comment the last line out if your don't want that.
### Files needed ######
# 1. pHCalibration.csv in your "Data" folder
#Inside the Data folder You must have a subfolder for each data set. In each subfolder there is:
#2. the mass file for your run
#3. a subfolder named "TodaysDate" (where all of your titration files are) directly exported from LabX.
# Created by Nyssa Silbiger 03/28/2014
# modified 20210126 Sam Gurr - set diff directories and such for PPP Lab titrator (URI)
# new acid bottle 20190626 by Sam Gurr - changed lines
#line 68 changed SampleID to Sample.ID - Sam Gurr 20180713
#modified 20210221 Danielle Becker - set different mass file and Titratorfile to match code
#modified 20210318 Danielle Becker - opened a new acid titrant, same batch #A16
#new acid bottle 20220127 by Danielle Becker - new batch number A22, updated script calculation
#------------------------------------------------------------
rm(list=ls())
#set working directory---------------------------------------------------------------------------------------------
setwd("C:/Users/PPP Lab/Documents/Titrator")
main<-getwd()
#load libraries----------------------------------------------
library(seacarb) #used to calculate TA
library(tidyverse)
#CHANGE THESE VALUES EVERY DAY----------------------------------------------
path<-"Data/BlueTank_Titrations/20220504" #the location of all your titration files, your folder of the day!
massfile<-"Mass_CRM_20220504.csv" # name of your file with masses
titrationfile<-'20220504_CRM_PutnamLab.csv'# name of the last titration file run
# Date that the data were run
date<-'20220504'
#DO NOT CHANGE ANYTHING BELOW THIS LINE UNLESS A NEW BOTTLE OF ACID IS USED
#load Data---------------------------------------------------
#load Mass Data
Mass<-read.csv(file.path(path,massfile), header=T, sep=",", na.string="NA", as.is=T)
#### pH Calibration #####
pHCal<-read.csv("Data/pHCalibration.csv") # read in the pH Calibration file
#select the calibration for the correct date
pHData<-pHCal[pHCal$Date==date,]
# calculate pH 3 and 3.5 based on the slope and intercept from pH 4, 7, and 10 calibration
mod.pH<-lm(c(pHData$pH4, pHData$pH7, pHData$pH10)~c(4,7,10)) # linear model
# print a plot of the relationship between pH and mV
png(paste0(path,"/",Sys.Date(),'pHmvplot.png'), height = 400, width = 400)
plot(c(4,7,10), c(pHData$pH4, pHData$pH7, pHData$pH10), xlab = 'pH', ylab = 'mv')
lines(c(4,7,10), predict(mod.pH))
R2<-summary(mod.pH)$r.squared
legend('topright', legend = bquote(R^2 == .(format(R2, digits = 3))), bty='n')
dev.off()
# Select the mV for pH=3 and pH=3.5 based on your probe calibration
pH35<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3.5
pH3<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3
##### titration###########
#create an empty matrix to put the TA values in
nrows<-nrow(Mass) #need file length/number of rows
TA <- data.frame(matrix(nrow = nrows, ncol = 4))
rownames(TA)<-Mass$Sample.ID1[1:nrows]
colnames(TA)<-c("SampleID",'TA','Mass','Salinity') # changed Sample.ID1 to SampleID in the TA data frame only
#run a for loop to bring in the titration files one at a time and calculate TA
# read in the mega concatenated titration results file
filename<-file.path(path,titrationfile)
AllData<-read.csv(filename, sep=",", na.string="NA", as.is=T, skip=4)[ ,1:5]
#Identifies rows starting with scope in column 1 of the titration file
sample_name_positions <- c(1,grep("^Scope", AllData[,1]), nrow(AllData))
## parse through all the data in the one file ###
sample_names<-Mass$Sample.ID1
# create a list with all the sample IDs
sample_names_list <- list()
for (item in 1:length(sample_names)){
sample_names_list[[item]] <- sample_names[item]
}
# fill the list with the data from each sample
for (i in 1:nrows){
sample_names_list[[i]]<-data.frame(AllData[sample_name_positions[i]:sample_name_positions[i+1],])
colnames(sample_names_list[[i]])<-c("Volume","Time","mV","Temperature","dV/dt")
}
Data<-sample_names_list[[i]]
Data$mV<-suppressWarnings(as.numeric(Data$mV)) ## supress the warnings since NA will be produced
Data$Temperature<-suppressWarnings(as.numeric(Data$Temperature))
Data$Volume<-suppressWarnings(as.numeric(Data$Volume))
name<-sample_names[i]
mV<-which(Data$mV<pH3 & Data$mV>pH35)
View(Data)
d<-(-0.00000400*mean(Data$Temperature[mV], na.rm=T)^2-0.0001116*mean(Data$Temperature[mV], na.rm=T)+1.02881) #20220127 Batch A22 DMBP
#Calculate total alkalinity using potentiometric titrations
#Uses a for loop to read in data exported as a titration file and calculate Total alkalinity
#At the end it exports your data as a .csv file. Comment the last line out if your don't want that.
### Files needed ######
# 1. pHCalibration.csv in your "Data" folder
#Inside the Data folder You must have a subfolder for each data set. In each subfolder there is:
#2. the mass file for your run
#3. a subfolder named "TodaysDate" (where all of your titration files are) directly exported from LabX.
# Created by Nyssa Silbiger 03/28/2014
# modified 20210126 Sam Gurr - set diff directories and such for PPP Lab titrator (URI)
# new acid bottle 20190626 by Sam Gurr - changed lines
#line 68 changed SampleID to Sample.ID - Sam Gurr 20180713
#modified 20210221 Danielle Becker - set different mass file and Titratorfile to match code
#modified 20210318 Danielle Becker - opened a new acid titrant, same batch #A16
#new acid bottle 20220127 by Danielle Becker - new batch number A22, updated script calculation
#------------------------------------------------------------
rm(list=ls())
#set working directory---------------------------------------------------------------------------------------------
setwd("C:/Users/PPP Lab/Documents/Titrator")
main<-getwd()
#load libraries----------------------------------------------
library(seacarb) #used to calculate TA
library(tidyverse)
#CHANGE THESE VALUES EVERY DAY----------------------------------------------
path<-"Data/BlueTank_Titrations/20220518" #the location of all your titration files, your folder of the day!
massfile<-"Mass_20220518.csv" # name of your file with masses
titrationfile<-'20220518_PutnamLab.csv'# name of the last titration file run
# Date that the data were run
date<-'20220518'
#DO NOT CHANGE ANYTHING BELOW THIS LINE UNLESS A NEW BOTTLE OF ACID IS USED
#load Data---------------------------------------------------
#load Mass Data
Mass<-read.csv(file.path(path,massfile), header=T, sep=",", na.string="NA", as.is=T)
#### pH Calibration #####
pHCal<-read.csv("Data/pHCalibration.csv") # read in the pH Calibration file
#select the calibration for the correct date
pHData<-pHCal[pHCal$Date==date,]
# calculate pH 3 and 3.5 based on the slope and intercept from pH 4, 7, and 10 calibration
mod.pH<-lm(c(pHData$pH4, pHData$pH7, pHData$pH10)~c(4,7,10)) # linear model
# print a plot of the relationship between pH and mV
png(paste0(path,"/",Sys.Date(),'pHmvplot.png'), height = 400, width = 400)
plot(c(4,7,10), c(pHData$pH4, pHData$pH7, pHData$pH10), xlab = 'pH', ylab = 'mv')
lines(c(4,7,10), predict(mod.pH))
R2<-summary(mod.pH)$r.squared
legend('topright', legend = bquote(R^2 == .(format(R2, digits = 3))), bty='n')
dev.off()
# Select the mV for pH=3 and pH=3.5 based on your probe calibration
pH35<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3.5
pH3<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3
##### titration###########
#create an empty matrix to put the TA values in
nrows<-nrow(Mass) #need file length/number of rows
TA <- data.frame(matrix(nrow = nrows, ncol = 4))
rownames(TA)<-Mass$Sample.ID1[1:nrows]
colnames(TA)<-c("SampleID",'TA','Mass','Salinity') # changed Sample.ID1 to SampleID in the TA data frame only
#run a for loop to bring in the titration files one at a time and calculate TA
# read in the mega concatenated titration results file
filename<-file.path(path,titrationfile)
AllData<-read.csv(filename, sep=",", na.string="NA", as.is=T, skip=4)[ ,1:5]
#Identifies rows starting with scope in column 1 of the titration file
sample_name_positions <- c(1,grep("^Scope", AllData[,1]), nrow(AllData))
## parse through all the data in the one file ###
sample_names<-Mass$Sample.ID1
# create a list with all the sample IDs
sample_names_list <- list()
for (item in 1:length(sample_names)){
sample_names_list[[item]] <- sample_names[item]
}
# fill the list with the data from each sample
for (i in 1:nrows){
sample_names_list[[i]]<-data.frame(AllData[sample_name_positions[i]:sample_name_positions[i+1],])
colnames(sample_names_list[[i]])<-c("Volume","Time","mV","Temperature","dV/dt")
}
Data<-sample_names_list[[i]]
Data$mV<-suppressWarnings(as.numeric(Data$mV)) ## supress the warnings since NA will be produced
Data$Temperature<-suppressWarnings(as.numeric(Data$Temperature))
Data$Volume<-suppressWarnings(as.numeric(Data$Volume))
name<-sample_names[i]
mV<-which(Data$mV<pH3 & Data$mV>pH35)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(Data)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
View(Data)
#Calculate total alkalinity using potentiometric titrations
#Uses a for loop to read in data exported as a titration file and calculate Total alkalinity
#At the end it exports your data as a .csv file. Comment the last line out if your don't want that.
### Files needed ######
# 1. pHCalibration.csv in your "Data" folder
#Inside the Data folder You must have a subfolder for each data set. In each subfolder there is:
#2. the mass file for your run
#3. a subfolder named "TodaysDate" (where all of your titration files are) directly exported from LabX.
# Created by Nyssa Silbiger 03/28/2014
# modified 20210126 Sam Gurr - set diff directories and such for PPP Lab titrator (URI)
# new acid bottle 20190626 by Sam Gurr - changed lines
#line 68 changed SampleID to Sample.ID - Sam Gurr 20180713
#modified 20210221 Danielle Becker - set different mass file and Titratorfile to match code
#modified 20210318 Danielle Becker - opened a new acid titrant, same batch #A16
#new acid bottle 20220127 by Danielle Becker - new batch number A22, updated script calculation
#------------------------------------------------------------
rm(list=ls())
#set working directory---------------------------------------------------------------------------------------------
setwd("C:/Users/PPP Lab/Documents/Titrator")
main<-getwd()
#load libraries----------------------------------------------
library(seacarb) #used to calculate TA
library(tidyverse)
#CHANGE THESE VALUES EVERY DAY----------------------------------------------
path<-"Data/BlueTank_Titrations/20220518" #the location of all your titration files, your folder of the day!
massfile<-"Mass_20220518.csv" # name of your file with masses
titrationfile<-'20220518_PutnamLab.csv'# name of the last titration file run
# Date that the data were run
date<-'20220518'
#DO NOT CHANGE ANYTHING BELOW THIS LINE UNLESS A NEW BOTTLE OF ACID IS USED
#load Data---------------------------------------------------
#load Mass Data
Mass<-read.csv(file.path(path,massfile), header=T, sep=",", na.string="NA", as.is=T)
#### pH Calibration #####
pHCal<-read.csv("Data/pHCalibration.csv") # read in the pH Calibration file
#select the calibration for the correct date
pHData<-pHCal[pHCal$Date==date,]
# calculate pH 3 and 3.5 based on the slope and intercept from pH 4, 7, and 10 calibration
mod.pH<-lm(c(pHData$pH4, pHData$pH7, pHData$pH10)~c(4,7,10)) # linear model
# print a plot of the relationship between pH and mV
png(paste0(path,"/",Sys.Date(),'pHmvplot.png'), height = 400, width = 400)
plot(c(4,7,10), c(pHData$pH4, pHData$pH7, pHData$pH10), xlab = 'pH', ylab = 'mv')
lines(c(4,7,10), predict(mod.pH))
R2<-summary(mod.pH)$r.squared
legend('topright', legend = bquote(R^2 == .(format(R2, digits = 3))), bty='n')
dev.off()
# Select the mV for pH=3 and pH=3.5 based on your probe calibration
pH35<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3.5
pH3<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3
##### titration###########
#create an empty matrix to put the TA values in
nrows<-nrow(Mass) #need file length/number of rows
TA <- data.frame(matrix(nrow = nrows, ncol = 4))
rownames(TA)<-Mass$Sample.ID1[1:nrows]
colnames(TA)<-c("SampleID",'TA','Mass','Salinity') # changed Sample.ID1 to SampleID in the TA data frame only
#run a for loop to bring in the titration files one at a time and calculate TA
# read in the mega concatenated titration results file
filename<-file.path(path,titrationfile)
AllData<-read.csv(filename, sep=",", na.string="NA", as.is=T, skip=4)[ ,1:5]
#Identifies rows starting with scope in column 1 of the titration file
sample_name_positions <- c(1,grep("^Scope", AllData[,1]), nrow(AllData))
## parse through all the data in the one file ###
sample_names<-Mass$Sample.ID1
# create a list with all the sample IDs
sample_names_list <- list()
for (item in 1:length(sample_names)){
sample_names_list[[item]] <- sample_names[item]
}
# fill the list with the data from each sample
for (i in 1:nrows){
sample_names_list[[i]]<-data.frame(AllData[sample_name_positions[i]:sample_name_positions[i+1],])
colnames(sample_names_list[[i]])<-c("Volume","Time","mV","Temperature","dV/dt")
}
Data<-sample_names_list[[i]]
Data$mV<-suppressWarnings(as.numeric(Data$mV)) ## supress the warnings since NA will be produced
Data$Temperature<-suppressWarnings(as.numeric(Data$Temperature))
Data$Volume<-suppressWarnings(as.numeric(Data$Volume))
name<-sample_names[i]
mV<-which(Data$mV<pH3 & Data$mV>pH35)
View(Data)
View(pHCal)
View(pHData)
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
