#------------------------------------------------------------
rm(list=ls())
setwd("C:/Users/PPP Lab/Documents/Titrator")
main<-getwd()
#load libraries----------------------------------------------
library(seacarb) #used to calculate TA
library(tidyverse)
#CHANGE THESE VALUES EVERY DAY----------------------------------------------
path<-"Data/BlueTank_Titrations/20220608" #the location of all your titration files, your folder of the day!
massfile<-"Mass_20220608.csv" # name of your file with masses
titrationfile<-'20220608_PutnamLab.csv'# name of the last titration file run
# Date that the data were run
date<-'20220608'
Mass<-read.csv(file.path(path,massfile), header=T, sep=",", na.string="NA", as.is=T)
pHCal<-read.csv("Data/pHCalibration.csv") # read in the pH Calibration file
pHData<-pHCal[pHCal$Date==date,]
mod.pH<-lm(c(pHData$pH4, pHData$pH7, pHData$pH10)~c(4,7,10)) # linear model
png(paste0(path,"/",Sys.Date(),'pHmvplot.png'), height = 400, width = 400)
plot(c(4,7,10), c(pHData$pH4, pHData$pH7, pHData$pH10), xlab = 'pH', ylab = 'mv')
lines(c(4,7,10), predict(mod.pH))
R2<-summary(mod.pH)$r.squared
legend('topright', legend = bquote(R^2 == .(format(R2, digits = 3))), bty='n')
dev.off()
pH35<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3.5
pH3<-mod.pH$coefficients[1]+mod.pH$coefficients[2]*3
nrows<-nrow(Mass) #need file length/number of rows
TA <- data.frame(matrix(nrow = nrows, ncol = 4))
rownames(TA)<-Mass$Sample.ID1[1:nrows]
colnames(TA)<-c("SampleID",'TA','Mass','Salinity') # changed Sample.ID1 to SampleID in the TA data frame only
#run a for loop to bring in the titration files one at a time and calculate TA
# read in the mega concatenated titration results file
filename<-file.path(path,titrationfile)
AllData<-read.csv(filename, sep=",", na.string="NA", as.is=T, skip=4)[ ,1:5]
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
titrationfile<-'20220608_PutnamLabPutnamLab.csv'# name of the last titration file run
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
source('~/Titrator/Scripts/Total_Alkalinity_wParsing.R')
